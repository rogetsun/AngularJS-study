<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../../assets/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" href="assets/css.css"/>
</head>
<body ng-app="ngShowcaseApp" ng-controller="ctrl.tree.treeData">
<div class="tree">
    <ul>
        <li ng-repeat="country in vm.countries" ng-class="{closed:vm.tree.isFolded(country)}">
            <div>
                <input type="checkbox" ng-model="country.checked" ng-change="vm.tree.check(country, country.checked)"
                       ng-class="{intermediate: vm.tree.isSemiChecked(country)}"/>
          <span ng-click="vm.tree.toggleFold(country)">
            <span class="glyphicon" ng-class="vm.tree.isFolded(country)?'glyphicon-plus':'glyphicon-minus'"></span>
            <img ng-src="images/{{country.flag}}"/>
            {{country.label}}
          </span>
            </div>
            <ul ng-class="{hidden: vm.tree.isFolded(country)}">
                <li ng-repeat="province in country.items" ng-class="{closed:vm.tree.isFolded(province)}">
                    <input type="checkbox" ng-model="province.checked"
                           ng-change="vm.tree.check(province, province.checked)"
                           ng-class="{intermediate: vm.tree.isSemiChecked(province)}"/>
            <span ng-click="vm.tree.toggleFold(province)">
              <span class="glyphicon" ng-class="vm.tree.isFolded(province)?'glyphicon-plus':'glyphicon-minus'"></span>
              {{province.label}}
            </span>
                    <ul ng-class="{hidden: vm.tree.isFolded(province)}">
                        <li ng-repeat="city in province.items">
                            <label>
                                <input type="checkbox" ng-model="city.checked"
                                       ng-change="vm.tree.check(city, city.checked)"/>
                                {{city.label}}
                            </label>
                        </li>
                    </ul>
                </li>
            </ul>
        </li>
    </ul>
</div>


<h3>说明</h3>
这是一个使用内部数据结构来封装级联逻辑的版本，相比directive来说，这种内部数据结构更容易测试，内聚性也更强。
</body>
<script src="../../assets/angular/angular.js"></script>
<script src="assets/underscore.min.js"></script>
<script src="assets/tree-data.js"></script>
<script>
    angular.module('ngShowcaseApp', ['treeData'])
            .controller('ctrl.tree.treeData', function ($scope, TreeData) {
                var vm = $scope.vm = {};

                vm.countries = [
                    {
                        label: '中国',
                        flag: 'cn.png',
                        items: [
                            {
                                label: '北京',
                                items: [
                                    {
                                        label: '朝阳区'
                                    },
                                    {
                                        label: '宣武区'
                                    },
                                    {
                                        label: '海淀区'
                                    }
                                ]
                            },
                            {
                                label: '河北',
                                items: [
                                    {
                                        label: '石家庄'
                                    },
                                    {
                                        label: '承德'
                                    },
                                    {
                                        label: '唐山'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        label: '美国',
                        flag: 'us.png',
                        items: [
                            {
                                label: '纽约',
                                items: [
                                    {
                                        label: '曼哈顿区'
                                    },
                                    {
                                        label: '皇后区'
                                    }
                                ]
                            },
                            {
                                label: '德克萨斯州',
                                items: [
                                    {
                                        label: '休斯顿'
                                    },
                                    {
                                        label: '达拉斯'
                                    }
                                ]
                            },
                            {
                                label: '加利福尼亚州'
                            }
                        ]
                    }
                ];
                vm.tree = new TreeData(vm.countries, false, false);
            });
</script>
</html>